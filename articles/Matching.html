<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BGSmartR">
<title>Method of Matching taxonomic records • BGSmartR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Method of Matching taxonomic records">
<meta property="og:description" content="BGSmartR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BGSmartR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Matching.html">Method of Matching taxonomic records</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="Matching_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="Matching_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Matching_files/datatables-binding-0.29/datatables.js"></script><link href="Matching_files/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Matching_files/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Matching_files/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="Matching_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="Matching_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Method of Matching taxonomic records</h1>
            
      
      
      <div class="d-none name"><code>Matching.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakepowellcubg.github.io/BGR/">BGSmartR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In BGSmartR we use an opinionated method to match taxonomic records
to enrichment databases (such as <a href="https://powo.science.kew.org" class="external-link">Plants of the World Online</a>
(POWO) or <a href="https://www.iucnredlist.org" class="external-link">IUCN Red List</a>) using
taxonomic names of plants . Our method is automatic and does not require
any manual alterations. Moreover, rather than rely on “fuzzy” matching
in difficult cases we apply criteria functions to find the best possible
match.</p>
<p>Below we detail how our method works.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Records in a collection are matched via their taxonomic name and
taxonomic author/s (if provided). A frustration with taxonomic data is
that often the taxonomic name itself is frequently not unique - for
example <a href="https://powo.science.kew.org/results?q=Abies%20taxifolia" class="external-link">Abies
taxifolia</a>. This is often compounded by collections not storing the
taxonomic author, resulting in multiple matches. Moreover, since
collections data are often converted from old paper records there is a
strong chance that there could be mistakes or typos in the taxonomic
name. For example an hybridization marker might be missed out or the
wrong infraspecific group used.</p>
<p>Hence, our method attempts to automatically fix these common
issues.</p>
<p>Matches of taxonomic records are found by processing the taxonomic
name and taxonomic author/s through a matching ‘pipeline’. The pipeline
is summarized in the flow chart below.</p>
<p><img src="images/flow.png"></p>
<p>Each taxonomic record is matched by flowing through the pipeline
shown. The purple state indicated the start of the algorithm. blue
states correspond to obtaining a match (or no match), yellow to process
steps and green to decisions that are made in the algorithm.</p>
<p>To match your collections data to POWO/Red list/BGCI the algorithm
has been wrapped into the function <code>enrich_report()</code>, using
specific matching functions for each enrichment database. These can be
used to match and enrich your collection without concerning yourself
with the method applied. See vignette XX to see the function in
action.</p>
<p>For a custom-pipeline we have included all the functions used in
<code>enrich_report()</code> which can be combined in any way
desired.</p>
<p>Below we delve further into the details of each step of the
algorithm.</p>
<hr>
</div>
<div class="section level2">
<h2 id="algorithm">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm"></a>
</h2>
<p><strong>(Below we will detail the algorithm for matching to
POWO)</strong></p>
<p>Before any matching can occur we require a local version of WCVP
information to be matched to. This can be created using
<code><a href="../reference/import_wcvp_names.html">import_wcvp_names()</a></code> function in BGSmartR. This takes the
version of wcvp from POWO and “enhances” it to include extra information
used in our matching algorithm.</p>
<p>This document outlines the method used to match taxonomic plant names
to Plants of the World Online (POWO) using BGSmartR. This is an
automatic process which only requires a list of plant names (and
authors), which we shall refer to as the original report.</p>
<p>The matching algorithm can be split into the following steps (number
corresponds to flowchart):</p>
<ul>
<li>&lt;1&gt; Sanitise taxon names</li>
<li>&lt;2&gt; Remove cultivars and indeterminantes</li>
<li>&lt;3&gt; Match taxon names to unique taxon names in POWO</li>
<li>&lt;4&gt; Match to non-unique taxon names in POWO</li>
<li>&lt;5&gt; Check for author mismatching</li>
<li>&lt;6&gt; Try and fix the taxonomic names</li>
<li><ol style="list-style-type: upper-alpha">
<li>Removing autonym</li>
</ol></li>
<li><ol start="2" style="list-style-type: upper-alpha">
<li>Adding hybridisation</li>
</ol></li>
<li><ol start="3" style="list-style-type: upper-alpha">
<li>Adding/changing infrageneric level</li>
</ol></li>
<li>&lt;7&gt; Try finding typos</li>
<li>Update matches to accepted names</li>
<li>Set remaining to not in POWO</li>
</ul>
<p>The algorithm runs the steps in this EXACT order.</p>
<p>After each step where matching occurs (2,3,4,6,7) the list of names
to match is reduced by the names that we found. In other words, once a
match is found for a single taxon name no more steps are taken. For
example, if we found adding hybridisation leads to a match to POWO we
will not search for typos.</p>
<p>In practice the algorithm will be run in a single step using the
function <code>match_original_to_wcvp()</code>.</p>
<p>We will now outline each step in the algorithm.</p>
<hr>
<div class="section level3">
<h3 id="sanitise-taxon-names">1) Sanitise taxon names<a class="anchor" aria-label="anchor" href="#sanitise-taxon-names"></a>
</h3>
<p>This step is used to standardise the format of the taxon name in the
original report. The standard format we implement is every character
should be lower case except for the first letter of the Genus. We
standardise the hybrid sign to be × rather than <code>x</code> or
<code>X</code> (or the rare case of <code>h</code> or <code>H</code>).
We also ensure that the infrageneric level is of the format
<code>f.</code>, <code>var.</code>, <code>subsp.</code> or
<code>nothosubsp.</code>.</p>
<p>Note that the sanitisation is also performed on POWO in the function
<code><a href="../reference/import_wcvp_names.html">import_wcvp_names()</a></code>.</p>
<p>This is performed on all taxon names that remain to be matched.</p>
<p>This is done using the function <code><a href="../reference/sanitise_name.html">sanitise_name()</a></code> which
takes a single taxon name as an input. Below we outline some examples of
using <code><a href="../reference/sanitise_name.html">sanitise_name()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sanitise_name.html">sanitise_name</a></span><span class="op">(</span><span class="st">'TRIGONELLA smyrnaea'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Trigonella smyrnaea"</span></span>
<span><span class="fu"><a href="../reference/sanitise_name.html">sanitise_name</a></span><span class="op">(</span><span class="st">'Halimium X pauanum'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Halimium × pauanum"</span></span>
<span><span class="fu"><a href="../reference/sanitise_name.html">sanitise_name</a></span><span class="op">(</span><span class="st">'Aruncus dioicus var acuminatus'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Aruncus dioicus var. acuminatus"</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="remove-cultivars-and-indeterminantes">2) Remove cultivars and indeterminantes<a class="anchor" aria-label="anchor" href="#remove-cultivars-and-indeterminantes"></a>
</h3>
<p>This step sets the match to <code>-1</code> for the taxon names we
know do not appear in POWO. This includes cultivars and indeterminants.
We find these taxon names by pattern matching in particular we check for
the following patterns.</p>
<ul>
<li>Includes <code>sp.</code>.</li>
<li>Includes <code>gx</code>.</li>
<li>Includes <code>gx</code>.</li>
<li>Includes <code>'XX'</code> for some text XX. This is common notation
for cultivars.</li>
<li>Includes <code>[</code>.</li>
<li>Begins with <code>Indet</code>.</li>
<li>Ends in <code>indet</code>.</li>
<li>Ends in <code>cv</code>.</li>
<li>Includes <code>cv.</code>.</li>
<li>Includes <code>Group</code>.</li>
<li>Includes <code>unkn</code>.</li>
<li>Ends in <code>hybrid</code>.</li>
<li>Includes <code>unknown</code>.</li>
</ul>
<p>This is performed using the function
<code><a href="../reference/match_single.html">no_match_cultivar_indet()</a></code>, which sets the match to
<code>-1</code> for any taxonomic name found to be either an
indeterminate or cultivar. For these taxon names we set the output
message to
<code>(Cultivar or Indeterminate &lt;Do not attempt matching&gt;)</code>.</p>
<p>Below we provide an example of
<code><a href="../reference/match_single.html">no_match_cultivar_indet()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">taxon_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Acalypha fruticulosa'</span>, <span class="st">'Asclepias sp.'</span>, <span class="st">"Abies umbilicata 'Some Cultivar'"</span>, </span>
<span>                 <span class="st">'Ammi copticum cv.'</span><span class="op">)</span></span>
<span> <span class="fu"><a href="../reference/match_single.html">no_match_cultivar_indet</a></span><span class="op">(</span><span class="va">taxon_names</span><span class="op">)</span></span>
<span><span class="co">#&gt; $match</span></span>
<span><span class="co">#&gt; [1] NA -1 -1 -1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] ""                                                         </span></span>
<span><span class="co">#&gt; [2] " -&gt; (Cultivar or Indeterminate &lt;Do not attempt matching&gt;)"</span></span>
<span><span class="co">#&gt; [3] " -&gt; (Cultivar or Indeterminate &lt;Do not attempt matching&gt;)"</span></span>
<span><span class="co">#&gt; [4] " -&gt; (Cultivar or Indeterminate &lt;Do not attempt matching&gt;)"</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="match-taxon-names-to-unique-taxon-names-in-powo">3) Match taxon names to unique taxon names in POWO<a class="anchor" aria-label="anchor" href="#match-taxon-names-to-unique-taxon-names-in-powo"></a>
</h3>
<p>This step matches the taxon names in the original report to the
records in POWO that have a unique taxon name. By this we mean the taxon
name exists for a single plant in POWO and there are not multiple plants
with different authors sharing the same taxonomic name.</p>
<p>As the name is unique no further matching criteria is required (e.g
authors).</p>
<p>This step is performed using the function
<code><a href="../reference/match_single.html">match_single()</a></code>.</p>
<p>Below we outline an example of this function in action:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choose some taxon names</span></span>
<span><span class="va">taxon_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amaranthus graecizans subsp. silvestris"</span>, <span class="st">"Amsonia ciliata"</span>, <span class="st">"Aristolochia islandica"</span>, <span class="st">"Adenocalymma scabriusculum"</span>, <span class="st">"Fake name"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Choose the indices of wcvp which correspond to a unique taxon name using `single_entry`.</span></span>
<span><span class="va">wcvp_search_index_single</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">$</span><span class="va">single_entry</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform the match</span></span>
<span><span class="va">match</span> <span class="op">=</span> <span class="fu"><a href="../reference/match_single.html">match_single</a></span><span class="op">(</span>taxon_names <span class="op">=</span> <span class="va">taxon_names</span>, enrich_database <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span>, enrich_database_search_index <span class="op">=</span> <span class="va">wcvp_search_index_single</span><span class="op">)</span></span>
<span><span class="va">match</span></span>
<span><span class="co">#&gt; $match</span></span>
<span><span class="co">#&gt; [1]  1  2  3  4 NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] " -&gt; (matches record with single entry) -&gt; (108437-3, Amaranthus graecizans subsp. silvestris)"</span></span>
<span><span class="co">#&gt; [2] " -&gt; (matches record with single entry) -&gt; (76904-1, Amsonia ciliata)"                         </span></span>
<span><span class="co">#&gt; [3] " -&gt; (matches record with single entry) -&gt; (19504-2, Aristolochia islandica)"                  </span></span>
<span><span class="co">#&gt; [4] " -&gt; (matches record with single entry) -&gt; (108156-1, Adenocalymma scabriusculum)"             </span></span>
<span><span class="co">#&gt; [5] ""</span></span></code></pre></div>
<p>We see that <code>match</code> is a list that contains:</p>
<ul>
<li>
<code>$match</code> the corresponding row in
<code>wcvp$wcvp_names</code>, if no match return <code>NA</code>.</li>
<li>
<code>$message</code> that informs on how the match is obtained, if
no match the message is set to <code>''</code>.</li>
</ul>
<p>If we find a match the algorithm by default also provides the
<code>powo_id</code> (e.g. <code>108437-3</code>) which can be used to
search for the plant directly on POWO’s website. This output code in the
message can be changed for any column in <code>wcvp$wcvp_names</code>
using the input <code>enrich_display_in_message_column</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_single.html">match_single</a></span><span class="op">(</span>taxon_names <span class="op">=</span> <span class="va">taxon_names</span>, enrich_database <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span>,</span>
<span>             enrich_database_search_index <span class="op">=</span> <span class="va">wcvp_search_index_single</span>,</span>
<span>             enrich_display_in_message_column <span class="op">=</span> <span class="st">'plant_name_id'</span><span class="op">)</span></span>
<span><span class="co">#&gt; $match</span></span>
<span><span class="co">#&gt; [1]  1  2  3  4 NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] " -&gt; (matches record with single entry) -&gt; (2632859, Amaranthus graecizans subsp. silvestris)"</span></span>
<span><span class="co">#&gt; [2] " -&gt; (matches record with single entry) -&gt; (8441, Amsonia ciliata)"                           </span></span>
<span><span class="co">#&gt; [3] " -&gt; (matches record with single entry) -&gt; (2651517, Aristolochia islandica)"                 </span></span>
<span><span class="co">#&gt; [4] " -&gt; (matches record with single entry) -&gt; (319419, Adenocalymma scabriusculum)"              </span></span>
<span><span class="co">#&gt; [5] ""</span></span></code></pre></div>
<p>Moreover, for this function the match can be changed from the row
number in <code>wcvp$wcvp_names</code> to any column using the input
<code>match_column</code>, for example</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_single.html">match_single</a></span><span class="op">(</span>taxon_names <span class="op">=</span> <span class="va">taxon_names</span>, enrich_database <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span>,</span>
<span>             enrich_database_search_index <span class="op">=</span> <span class="va">wcvp_search_index_single</span>,</span>
<span>             match_column <span class="op">=</span> <span class="st">'taxon_status'</span><span class="op">)</span></span>
<span><span class="co">#&gt; $match</span></span>
<span><span class="co">#&gt; [1] "Accepted" "Accepted" "Accepted" "Accepted" NA        </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] " -&gt; (matches record with single entry) -&gt; (108437-3, Amaranthus graecizans subsp. silvestris)"</span></span>
<span><span class="co">#&gt; [2] " -&gt; (matches record with single entry) -&gt; (76904-1, Amsonia ciliata)"                         </span></span>
<span><span class="co">#&gt; [3] " -&gt; (matches record with single entry) -&gt; (19504-2, Aristolochia islandica)"                  </span></span>
<span><span class="co">#&gt; [4] " -&gt; (matches record with single entry) -&gt; (108156-1, Adenocalymma scabriusculum)"             </span></span>
<span><span class="co">#&gt; [5] ""</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="match-to-non-unique-taxon-names-in-powo">4) Match to non-unique taxon names in POWO<a class="anchor" aria-label="anchor" href="#match-to-non-unique-taxon-names-in-powo"></a>
</h3>
<p>This step searches for matches to POWO when the taxon name has
multiple entries in POWO.</p>
<p>For example suppose our database contains the taxon name
<code>'Abies taxifolia'</code>. Searching in POWO we find 6 records for
that taxon name.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b6598a1ccb5fb08470f4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b6598a1ccb5fb08470f4">{"x":{"filter":"none","vertical":false,"data":[["146571","146655","146808","176533","176535","688734"],[382029,382030,382027,382028,382031,382032],["Abies taxifolia","Abies taxifolia","Abies taxifolia","Abies taxifolia","Abies taxifolia","Abies taxifolia"],["Desf.","Raf.","Duhamel","Poir.","C.Presl","J.Jeffrey ex Gordon &amp; Glend."],["Synonym","Synonym","Synonym","Illegitimate","Synonym","Invalid"],[381621,381621,381621,469725,469725,469765]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>plant_name_id<\/th>\n      <th>taxon_name<\/th>\n      <th>taxon_authors<\/th>\n      <th>taxon_status<\/th>\n      <th>accepted_plant_name_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>In WCVP each taxon name has an author, a taxon status and an accepted
plant name. These quantities can be used to decide which record we
should match to.</p>
<div class="section level4">
<h4 id="matching-criteria-">Matching Criteria.<a class="anchor" aria-label="anchor" href="#matching-criteria-"></a>
</h4>
<p>The matching criteria is split into two parts: author matching and
other matching. Author matching has higher priority and is performed
using the function <code><a href="../reference/match_authors.html">match_authors()</a></code>. This will initially try
to match the author exactly. If there are no exact matches it will then
look for partial matches where both the authors for an item in the
collection and WCVP share words.</p>
<p>Example of exact matching.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restrict wcvp to only taxon_name = 'Abies taxifolia'</span></span>
<span><span class="va">wcvp_Abies_taxifolia</span> <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">[</span><span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">$</span><span class="va">taxon_name</span> <span class="op">==</span> <span class="st">'Abies taxifolia'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">collection_author</span> <span class="op">=</span> <span class="st">'Desf.'</span></span>
<span><span class="va">wcvp_authors</span> <span class="op">=</span> <span class="va">wcvp_Abies_taxifolia</span><span class="op">$</span><span class="va">taxon_authors</span></span>
<span></span>
<span><span class="co"># Match via authors</span></span>
<span><span class="va">matched_info</span> <span class="op">=</span> <span class="fu"><a href="../reference/match_authors.html">match_authors</a></span><span class="op">(</span><span class="va">collection_author</span>,<span class="va">wcvp_authors</span><span class="op">)</span></span>
<span><span class="va">matched_info</span></span>
<span><span class="co">#&gt; $wanted</span></span>
<span><span class="co">#&gt; [1]  TRUE FALSE FALSE FALSE FALSE FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "(Exact author match) -&gt; "</span></span>
<span></span>
<span><span class="co"># Restrict wcvp_Abies_taxifolia to only matched authors</span></span>
<span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">wcvp_Abies_taxifolia</span><span class="op">[</span><span class="va">matched_info</span><span class="op">$</span><span class="va">wanted</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d2958dc6f7af6485809c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d2958dc6f7af6485809c">{"x":{"filter":"none","vertical":false,"data":[["146571"],[382029],["Abies taxifolia"],["Desf."],["Synonym"],[381621]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>plant_name_id<\/th>\n      <th>taxon_name<\/th>\n      <th>taxon_authors<\/th>\n      <th>taxon_status<\/th>\n      <th>accepted_plant_name_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Example of partial matching.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collection_author</span> <span class="op">=</span> <span class="st">'Jeffrey'</span></span>
<span></span>
<span><span class="co"># Match via authors</span></span>
<span><span class="va">matched_info</span> <span class="op">=</span> <span class="fu"><a href="../reference/match_authors.html">match_authors</a></span><span class="op">(</span><span class="va">collection_author</span>,<span class="va">wcvp_authors</span><span class="op">)</span></span>
<span><span class="va">matched_info</span></span>
<span><span class="co">#&gt; $wanted</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE FALSE FALSE FALSE  TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "(Partial author &lt;most words&gt;) -&gt; "</span></span>
<span></span>
<span><span class="co"># Restrict wcvp_Abies_taxifolia to only matched authors</span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">wcvp_Abies_taxifolia</span><span class="op">[</span><span class="va">matched_info</span><span class="op">$</span><span class="va">wanted</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ed02ffb5662ec761c9c9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ed02ffb5662ec761c9c9">{"x":{"filter":"none","vertical":false,"data":[["688734"],[382032],["Abies taxifolia"],["J.Jeffrey ex Gordon &amp; Glend."],["Invalid"],[469765]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>plant_name_id<\/th>\n      <th>taxon_name<\/th>\n      <th>taxon_authors<\/th>\n      <th>taxon_status<\/th>\n      <th>accepted_plant_name_id<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>By default partial matching chooses the records that shares the most
words with the author given in the collection (by default the input
<code>partial_method = 'most words'</code>) this can be changed to chose
any record with any level of partial matching using
<code>partial_method = 'any words'</code>.</p>
<hr>
<p>Other matching is performed by the so called
<code>matching_criteria()</code> function, this takes an extract of the
enrichment database (often those with idenitical taxon names) and
attempts to choose the best record using some criteria and returns the
rows which correspond to the best match.</p>
<p>To allow flexibility this function is passed as the input
<code>matching_criteria</code> to
<code><a href="../reference/match_single.html">get_match_from_multiple()</a></code>, the function that applies both
author matching and other matching. The package contains two matching
criteria functions <code><a href="../reference/no_additional_matching.html">no_additional_matching()</a></code> and
<code><a href="../reference/no_additional_matching.html">additional_wcvp_matching()</a></code>.</p>
<p><code><a href="../reference/no_additional_matching.html">additional_wcvp_matching()</a></code> matches records by first
looking at <code>accepted_plant_name_id</code> of the wcvp records
passed to it, if all the accepted plants names are the same the function
returns an accepted taxon status row or if non of these exists just the
first row. If there are differences in
<code>accepted_plant_name_id</code> then the function looks at
<code>taxon_status</code> and returns any rows that are accepted, and if
non are accepted any that are synonyms.</p>
<p>A couple examples are given below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply to first 3 rows of taxon name  = Abies_taxifolia (i.e all have the same accepted plant name id)</span></span>
<span><span class="fu"><a href="../reference/no_additional_matching.html">additional_wcvp_matching</a></span><span class="op">(</span><span class="va">wcvp_Abies_taxifolia</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; $row</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "(all point to same accepted plant)"</span></span>
<span></span>
<span><span class="co"># Apply to rows 1,4,6 of taxon name  = Abies_taxifolia (i.e differing accepted plant name ids only only has taxon status = synonym)</span></span>
<span><span class="fu"><a href="../reference/no_additional_matching.html">additional_wcvp_matching</a></span><span class="op">(</span><span class="va">wcvp_Abies_taxifolia</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; $row</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "(choose via taxon_status)"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="matching-function-">matching function.<a class="anchor" aria-label="anchor" href="#matching-function-"></a>
</h4>
<p>The author matching and other matching is combined into the function
<code><a href="../reference/match_single.html">get_match_from_multiple()</a></code> for a single taxonomic name and
author.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_single.html">get_match_from_multiple</a></span><span class="op">(</span>taxon_name_and_author <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Abies taxifolia'</span>, <span class="st">'Desf.'</span><span class="op">)</span>,</span>
<span>                        enrich_database_mult <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">[</span><span class="op">!</span><span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">$</span><span class="va">single_entry</span>,<span class="op">]</span>, <span class="co">#wcvp restricted to only non-unique taxon names.</span></span>
<span>                        matching_criterion <span class="op">=</span> <span class="fu">BGSmartR</span><span class="fu">::</span><span class="va"><a href="../reference/no_additional_matching.html">additional_wcvp_matching</a></span>,</span>
<span>                        enrich_taxon_authors_column <span class="op">=</span> <span class="st">'taxon_authors'</span><span class="op">)</span> <span class="co"># the column in wcvp referring to taxon_authors</span></span>
<span><span class="co">#&gt; $plant_identifer</span></span>
<span><span class="co">#&gt; [1] 382029</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "(Multiple records in enriched database) -&gt; (Exact author match) -&gt; "</span></span></code></pre></div>
<p>Then to do matching for multiple records in one go we use the
function <code><a href="../reference/match_single.html">match_multiple()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxon_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Abies taxifolia'</span>, <span class="st">'Abies taxifolia'</span>, <span class="st">'Other Name'</span><span class="op">)</span></span>
<span><span class="va">taxon_authors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Desf.'</span>, <span class="st">'Jeffrey'</span>, <span class="st">'Craig'</span><span class="op">)</span></span>
<span><span class="va">enrich_database</span> <span class="op">=</span> <span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span></span>
<span><span class="va">enrich_database_search_index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">wcvp</span><span class="op">$</span><span class="va">wcvp_names</span><span class="op">$</span><span class="va">single_entry</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/match_single.html">match_multiple</a></span><span class="op">(</span><span class="va">taxon_names</span>,</span>
<span>               <span class="va">taxon_authors</span>,</span>
<span>               <span class="va">enrich_database</span>,</span>
<span>               <span class="va">enrich_database_search_index</span>,</span>
<span>               show_progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               enrich_taxon_authors_column <span class="op">=</span> <span class="st">'taxon_authors'</span><span class="op">)</span></span>
<span><span class="co">#&gt; $match</span></span>
<span><span class="co">#&gt; [1]  5 10 NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] " -&gt; (Multiple records in enriched database) -&gt; (Exact author match) -&gt;  -&gt; (261644-1, Abies taxifolia)"         </span></span>
<span><span class="co">#&gt; [2] " -&gt; (Multiple records in enriched database) -&gt; (Partial author &lt;most words&gt;) -&gt;  -&gt; (261645-1, Abies taxifolia)"</span></span>
<span><span class="co">#&gt; [3] ""</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="check-original-author-names-compared-to-matched-authors">5) Check original author names compared to matched authors<a class="anchor" aria-label="anchor" href="#check-original-author-names-compared-to-matched-authors"></a>
</h3>
<p>This step is used to compare the author names in the original report
and the matched record in POWO. The authors are judged to be in one of 3
categories:</p>
<ul>
<li>
<code>Exact</code> match, the authors are identical.</li>
<li>
<code>Partial</code> match, the authors are split into words and at
least one word is contained in the other (i.e a word in original author
is in matched author, or vice versa).</li>
<li>
<code>Different</code>, the authors are not in the above
categories.</li>
</ul>
<p>To extract words from an author name we use the function
<code><a href="../reference/author_words.html">author_words()</a></code>. This extracts all words which start with a
capital letter and has at least length 3 (including hyphens), together
with <code>DC.</code>, <code>Sm.</code> and <code>Br.</code>. Below we
provide an example</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># author_words('Nakai &amp; Tuyama')</span></span>
<span><span class="co"># author_words('J.C.Wendl. ex Hornem.')</span></span></code></pre></div>
<p>The comparison of authors is performed by the function
<code><a href="../reference/author_check.html">author_check()</a></code> which given the original author and the
matched author returns one of the three messages outlined above. For
example</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># author_check('Oliv.','Oliv.')</span></span>
<span><span class="co"># author_check('(Bong.) D.Don (Piper) C.L.Hitche','(Piper) C.H.Hitchc.')</span></span>
<span><span class="co"># author_check('L.','(W.D.J.Koch) Arcang.')</span></span></code></pre></div>
<p>The matching also returns the ‘match’ names and authors prior to
converting to accepted names.</p>
<hr>
</div>
<div class="section level3">
<h3 id="try-and-fix-the-taxon">6) Try and fix the taxon<a class="anchor" aria-label="anchor" href="#try-and-fix-the-taxon"></a>
</h3>
<p>This step tries 3 methods to try and fix the taxon to get a match</p>
<div class="section level4">
<h4 id="a-try-removing-autonym">A) Try removing autonym<a class="anchor" aria-label="anchor" href="#a-try-removing-autonym"></a>
</h4>
<p>This step tries to match taxon names after the autonym has been
removed.</p>
<p>For example suppose we have
<code>'Acmena hemilampra subsp. hemilampra'</code> in our original
report. This does not exist in POWO. If we remove the autonym then we
might be able to match a record in POWO. Therefore we want to try 1
‘potential’ taxon name:</p>
<p>The ‘potential’ taxon name is matched to POWO using steps (5) and
(6), to match to unique and non-unique taxon names respectively. If a
single match is found we return this.</p>
<p>This is all contained in the function
<code>match_rm_autonym()</code>, which takes as an input the taxon
names, taxon names with the author and POWO information and returns the
matches. This is shown below in an example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Choose some taxon names</span></span>
<span><span class="co"># taxon_names = c('Acmena hemilampra subsp. hemilampra', 'Aesculus rubicunda',</span></span>
<span><span class="co">#                 'Acacia fake var. fake')</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Perform the match</span></span>
<span><span class="co"># match = match_rm_autonym(taxon_names = taxon_names, taxon_authors = taxon_names, enrich_database = wcvp$wcvp_names)</span></span>
<span><span class="co"># match</span></span></code></pre></div>
<p>We see that if we find a match to the potential taxon name we return
the index of the match, and a message informing that we removed the
autonym. Potential names that do not find a match and taxon names that
are not autonyms have match equal to <code>NA</code> and no message.</p>
<hr>
</div>
<div class="section level4">
<h4 id="b-try-adding-hybridisation">B) Try adding hybridisation<a class="anchor" aria-label="anchor" href="#b-try-adding-hybridisation"></a>
</h4>
<p>This step checks whether adding or removing hybrid markers yields a
match. In particular, this step will consider three cases:</p>
<hr style="border: 0.3px solid green; width:80%;">
<div class="section level6">
<h6 id="single-words">1) Single words<a class="anchor" aria-label="anchor" href="#single-words"></a>
</h6>
<p>For example suppose we have <code>'Asplenosorus'</code> in our
original report. This does not exist in POWO. Maybe we have a missing
hybrid at the start, which could be either <code>×</code> or
<code>+</code>. Therefore we want to try 2 ‘potential’ taxon names:</p>
</div>
<div class="section level6">
<h6 id="taxon-names-with-no-hybrid-and-contains-234-words-">2) Taxon names with no hybrid and contains 2/3/4 words.<a class="anchor" aria-label="anchor" href="#taxon-names-with-no-hybrid-and-contains-234-words-"></a>
</h6>
<p>For example suppose we have
<code>'Aesculus rubicunda var. whitleyi'</code> in our original report.
This does not exist in POWO. Maybe we have a missing hybrid at the start
or after the first word. The hybrid symbol could be either
<code>×</code> or <code>+</code>. Therefore we want to try 4 ‘potential’
taxon names:</p>
</div>
<div class="section level6">
<h6 id="taxon-names-that-contain-exactly-one-or--">3) Taxon names that contain exactly one <code>×</code> or
<code>+</code>.<a class="anchor" aria-label="anchor" href="#taxon-names-that-contain-exactly-one-or--"></a>
</h6>
<p>For example suppose we have <code>'Artemisia + pfaffii'</code> in our
original report. This does not exist in POWO. Maybe the hybrid symbol is
wrong (should be <code>×</code>) or perhaps there should not be a hybrid
symbol at all. Therefore we want to try 2 ‘potential’ taxon names:</p>
<hr style="border: 0.3px solid green; width:80%;">
<p>For each of the three cases we then match the ‘potential’ taxon names
to POWO using steps (5) and (6), to match to unique and non-unique taxon
names respectively. If a single match is found we return this. If
multiple potential matches are found we change the output message
informing the user that multiple matches are found and for which names
this is the case, and no match is found.</p>
<p>This is all contained in the function
<code>match_hybrid_issue()</code>, which takes as an input the taxon
names, taxon names with the author and POWO information and returns the
matches. This is shown below in an example.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Choose some taxon names</span></span>
<span><span class="co"># taxon_names = c('Asplenosorus', 'Aesculus rubicunda var. whitleyi',</span></span>
<span><span class="co">#                 'Artemisia + pfaffii', 'Acacia fake name')</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Perform the match</span></span>
<span><span class="co"># match = match_hybrid_issue(taxon_names = taxon_names, taxon_authors = taxon_names, enrich_database = wcvp$wcvp_names)</span></span>
<span><span class="co"># match</span></span></code></pre></div>
<p>We see that if we find a single match in the potential taxon names
then the index of the match is returned. If multiple potential names
find matches then the match index is set to <code>-5</code> and the
message informs of the potential taxon names that lead to matches (this
is not shown in the example above as no cases exist when the first
letter is A, for an example see Try adding/changing infrageneric level).
If we find no matches for any of the potential names the index is set to
<code>NA</code> and the message is left blank.</p>
<hr>
</div>
</div>
<div class="section level4">
<h4 id="c-try-addingchanging-infrageneric-level">C) Try adding/changing infrageneric level<a class="anchor" aria-label="anchor" href="#c-try-addingchanging-infrageneric-level"></a>
</h4>
<p>This step checks whether adding or updating infrageneric level
information yields a match. In particular, this step will consider three
cases:</p>
<hr style="border: 0.3px solid green; width:80%;">
<div class="section level6">
<h6 id="adding-infrageneric-level-and-hybrid-to-taxon-names-with-three-words-">1) Adding infrageneric level (and hybrid) to taxon names with three
words.<a class="anchor" aria-label="anchor" href="#adding-infrageneric-level-and-hybrid-to-taxon-names-with-three-words-"></a>
</h6>
<p>For example suppose we have
<code>'Amorphophallus calabaricus mayoi'</code> in our original report.
We see that as we have three words we have potentially missed adding the
infrageneric level to the taxon name. This could be either:
<code>subsp.</code>, <code>var.</code>, <code>f.</code> or
<code>nothosubsp.</code>. Moreover, since we missed the infrageneric
level we might have also missed hybridisation. so we also want to check
if we need to add <code>×</code> to the taxon name. Therefore, we want
to try 8 ‘potential’ taxon names:</p>
</div>
<div class="section level6">
<h6 id="adding-infrageneric-level-to-taxon-names-with-four-words-that-contain-hybrid-">2) Adding infrageneric level to taxon names with four words that
contain hybrid.<a class="anchor" aria-label="anchor" href="#adding-infrageneric-level-to-taxon-names-with-four-words-that-contain-hybrid-"></a>
</h6>
<p>For example suppose we have
<code>'Potamogeton × spathulatus svecicusi'</code> in our original
report. We see that as we have four words including a hybrid. Thus we
might have potentially missed adding the infrageneric level after the
third word in the taxon name. This could be either: <code>subsp.</code>,
<code>var.</code>, <code>f.</code> or <code>nothosubsp.</code>.
Therefore, we want to try 4 ‘potential’ taxon names:</p>
</div>
<div class="section level6">
<h6 id="changing-the-infrageneric-level-">3) Changing the infrageneric level.<a class="anchor" aria-label="anchor" href="#changing-the-infrageneric-level-"></a>
</h6>
<p>For example suppose we have <code>'Ajuga chamaepitys f. media'</code>
in our original report. This taxonomic names does not match any record
in POWO. Thus the infrageneric level could be wrong. This could be
either: <code>subsp.</code>, <code>var.</code> or
<code>nothosubsp.</code>. Therefore, we want to try 3 ‘potential’ taxon
names:</p>
<hr style="border: 0.3px solid green; width:80%;">
<p>For each of the three cases we then match the ‘potential’ taxon names
to POWO using steps (5) and (6), to match to unique and non-unique taxon
names respectively. If a single match is found we return this. If
multiple potential matches are found we change the output message
informing the user that multiple matches are found and for which names
this is the case, and no match is found.</p>
<p>This is all contained in the function <code>add_splitter()</code>,
which takes as an input the taxon names, taxon names with the author and
POWO information and returns the matches. This is shown below in an
example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Choose some taxon names</span></span>
<span><span class="co"># taxon_names = c('Atractylis carduus glabrescens', 'Asplenium × corbariense andorranum',</span></span>
<span><span class="co">#                 'Atriplex glabriuscula f. franktonii', 'Acacia tortilis raddiana', 'Acacia fake name')</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Perform the match</span></span>
<span><span class="co"># match = match_splitter_issue(taxon_names = taxon_names, taxon_authors = taxon_names, enrich_database = wcvp$wcvp_names)</span></span>
<span><span class="co"># match</span></span></code></pre></div>
<p>We see that if we find a single match in the potential taxon names
then the index of the match is returned. If multiple potential names
find matches then the match index is set to <code>-5</code> and the
message informs of the potential taxon names that lead to matches. If we
find no matches for any of the potential names the index is set to
<code>NA</code> and the message is left blank.</p>
<hr>
</div>
</div>
</div>
<div class="section level3">
<h3 id="try-find-typo">7) Try find typo<a class="anchor" aria-label="anchor" href="#try-find-typo"></a>
</h3>
<p>This stage searches for typos in the taxon name. Typos are found in
three ways:</p>
<hr style="border: 0.3px solid green; width:80%;">
<div class="section level6">
<h6 id="searching-a-data-frame-of-original-names-and-fixed-names-">Searching a data frame of original names and fixed names.<a class="anchor" aria-label="anchor" href="#searching-a-data-frame-of-original-names-and-fixed-names-"></a>
</h6>
<p>In our package we include a data frame of typos that can be found by
<code><a href="../reference/typo_list.html">BGSmartR::typo_list</a></code>. This contains 9,782 typos that we have
found in garden databases.</p>
<p>We first find typos by checking against
<code><a href="../reference/typo_list.html">BGSmartR::typo_list</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># head(BGSmartR::typo_list)</span></span></code></pre></div>
</div>
<div class="section level6">
<h6 id="searching-for-common-issues-found-in-taxon-names-">Searching for common issues found in taxon names.<a class="anchor" aria-label="anchor" href="#searching-for-common-issues-found-in-taxon-names-"></a>
</h6>
<p>If we have not found a match in the typo list we then check for
common issues found in taxon names. This includes changing the end of
the taxon name. In particular we check for the following endings and
their replacements.</p>
<ul>
<li>‘i’ &lt;-&gt; ‘ii’</li>
<li>‘i’ &lt;-&gt; ‘ae’</li>
<li>‘a’ &lt;-&gt; ‘um’</li>
<li>‘a’ &lt;-&gt; ‘us’</li>
<li>‘ae’ &lt;-&gt; ‘eae’</li>
<li>‘e’ &lt;-&gt; ‘is’</li>
<li>‘is’ &lt;-&gt;‘e’</li>
<li>‘us’ &lt;-&gt; ‘is’</li>
<li>‘ense’ &lt;-&gt;‘iense’</li>
<li>‘oides’ &lt;-&gt; ‘ioides’</li>
<li>‘orum’ &lt;-&gt; ‘iorum’</li>
</ul>
<p>We also check the following patterns anywhere in the taxon name:</p>
<ul>
<li>‘i’ &lt;-&gt; ‘ae’</li>
</ul>
</div>
<div class="section level6">
<h6 id="searching-for-a-single-change-in-letter-">Searching for a single change in letter.<a class="anchor" aria-label="anchor" href="#searching-for-a-single-change-in-letter-"></a>
</h6>
<p>Our final stage performs a larger check for a change in single
character. This involves:</p>
<ul>
<li>Checking removing a single character from the taxon name in all
positions.</li>
<li>Checking adding a single character (a-z and ‘-’) in all
positions.</li>
<li>Changing a current letter to any character in a-z in all
positions.</li>
</ul>
<hr style="border: 0.3px solid green; width:80%;">
<p>To check whether a typo exists we can use the function
<code><a href="../reference/match_single.html">check_taxon_typo()</a></code>, which checks all potential fixes
against the names in POWO.</p>
<p>To check for typos and match to records in POWO we use the function
<code>match_typo()</code>. An example is outlined below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Choose some taxon names</span></span>
<span><span class="co"># taxon_names = c('Acalypha stellipilus', 'Aiphanes lucana',</span></span>
<span><span class="co">#                 'Acer × pseudocreticums', 'Amaranthus paraguay-ensis', 'Acacia fake name')</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Perform the match</span></span>
<span><span class="co"># match = match_typos(taxon_names = taxon_names, taxon_authors = taxon_names, enrich_database = wcvp$wcvp_names, typo_method = 'full')</span></span>
<span><span class="co"># match</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="update-matches-to-accepted-names">12) Update matches to accepted names<a class="anchor" aria-label="anchor" href="#update-matches-to-accepted-names"></a>
</h3>
<p>To update taxon names to their accepted form we use the field
<code>accepted_plant_name_id</code> in POWO. If the
<code>accepted_plant_name_id</code> does not match
<code>plant_name_id</code> then we update the match to correspond to the
accepted plant. This is performed by the function
<code><a href="../reference/convert_to_accepted_name.html">convert_to_accepted_name()</a></code> in BGSmartR, which takes in the
current state of the matches and updates to the accepted form. An
example is given below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># taxon_names = c('Adina nobilis', 'Acalypha gracilens var. fraseri', </span></span>
<span><span class="co">#                 'Andira zehntneri')</span></span>
<span><span class="co"># match = match_single(taxon_names,wcvp$wcvp_names,wcvp_search_index_single)</span></span>
<span><span class="co"># match</span></span>
<span><span class="co"># new_match = convert_to_accepted_name(match$match, wcvp)</span></span>
<span><span class="co"># new_match</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #Putting the messages together.</span></span>
<span><span class="co"># messages = paste0(match$message, new_match$message)</span></span>
<span><span class="co"># messages</span></span></code></pre></div>
<p>We see that the first two taxon names go to an accepted form and the
third does not. This is shown by both <code>$match</code> remaining the
same and an empty <code>$message</code> after running
<code><a href="../reference/convert_to_accepted_name.html">convert_to_accepted_name()</a></code>.</p>
<p>We can check the accepted name by using the codes provided in the
message on POWO’s website. This is done by changing the last part of the
URL. For example <code>Adina nobilis</code> can be found at the address
<a href="https://powo.science.kew.org/taxon/urn:lsid:ipni.org:names:742921-1" class="external-link uri">https://powo.science.kew.org/taxon/urn:lsid:ipni.org:names:742921-1</a>.
We see that this is indeed a synonym of Adina racemosa.</p>
<hr>
</div>
<div class="section level3">
<h3 id="set-remaining-to-not-in-powo">13) Set remaining to not in POWO<a class="anchor" aria-label="anchor" href="#set-remaining-to-not-in-powo"></a>
</h3>
<p>We set the match index to <code>-3</code> for the remaining taxon
names. In the messages we add <code>(Not in POWO)</code>.</p>
<hr>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jake Powell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
